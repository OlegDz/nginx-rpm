diff -ruN ngx_http_enhanced_memcached_module-master.orig/config ngx_http_enhanced_memcached_module-master/config
--- ngx_http_enhanced_memcached_module-master.orig/config	2015-09-24 04:49:29.000000000 +0000
+++ ngx_http_enhanced_memcached_module-master/config	2016-02-17 08:19:46.962048122 +0000
@@ -1,7 +1,15 @@
 ngx_addon_name="ngx_http_enhanced_memcached_module"
 
-HTTP_MODULES="$HTTP_MODULES \
-	ngx_http_enhanced_memcached_module"
+HTTP_ENHANCED_MEMCACHED_SRCS="\
+	$ngx_addon_dir/ngx_http_enhanced_memcached_module.c"
 
-NGX_ADDON_SRCS="$NGX_ADDON_SRCS \
-	$ngx_addon_dir/ngx_http_enhanced_memcached_module.c"
\ No newline at end of file
+if [ -n "$ngx_module_link" ]; then
+    ngx_module_type=HTTP
+    ngx_module_name=$ngx_addon_name
+    ngx_module_srcs="$HTTP_ENHANCED_MEMCACHED_SRCS"
+
+    . auto/module
+else
+    HTTP_MODULES="$HTTP_MODULES $ngx_addon_name"
+    NGX_ADDON_SRCS="$NGX_ADDON_SRCS $HTTP_ENHANCED_MEMCACHED_SRCS"
+fi
